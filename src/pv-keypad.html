<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<!-- <link rel="import" href="../bower_components/paper-button/paper-button.html"> -->


<dom-module id="pv-keypad">
    <template>
        <style>
            .button {
                fill: #000000;
            }

            svg {
                max-width: 100%;
                max-height: 100%;
                height: 100%;
            }

            .container {
                margin: 20px;
                height: 100%;
            }
        </style>
        <div class="container" hidden$="[[hide]]">
            <div style="height: 100%">
                <svg id="keypad" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 377.15353 617.03544" height="658.171" width="402.297">
                    <g transform="translate(-233.705 -256.274)">
                        <rect width="376.654" height="132.389" x="233.955" y="256.524" rx="3.543" ry="3.543" fill="#646464" stroke="#000" stroke-width=".5"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <rect width="376.654" height="480.67" x="233.955" y="392.39" rx="3.543" ry="3.543" fill="#646464" stroke="#000" stroke-width=".5"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <path fill="#464646" stroke="#000" stroke-width=".5" stroke-linecap="round" stroke-linejoin="round" d="M236.508 388.911h371.547v3.543H236.508z"
                        />
                        <rect width="282.965" height="419.382" x="280.799" y="408.24" rx="10.63" ry="10.63" fill="#464646" stroke="#000" stroke-width=".5"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <g transform="translate(305.09 3.845)">
                            <rect rx="7.087" ry="7.087" y="414.568" x="54.698" height="59.436" width="124.987" fill="#fff" stroke="#333" stroke-width=".8"
                            />
                            <path d="M73.403 467.317l43.789-46.063 43.788 46.063z" fill="#1a1a1a" />
                        </g>
                        <g transform="translate(-197.493 132.572)">
                            <rect width="59.436" height="124.987" x="691.04" y="355.38" ry="7.087" rx="7.087" fill="#fff" stroke="#333" stroke-width=".8"
                            />
                            <path d="M717.163 471.264s18.589-32.437 11.395-80.253l8.676-2.7-29.355-23.827-1.799 34.844 10.342-3.573c6.967 42.935-12.14 69.888-12.14 69.888l12.881 5.621z"
                                fill="#1a1a1a" />
                        </g>
                        <g transform="translate(343.273 44.98)">
                            <rect width="124.987" height="59.436" x="16.514" y="577.855" ry="7.087" rx="7.087" fill="#fff" stroke="#333" stroke-width=".8"
                            />
                            <path d="M122.797 584.541l-43.789 46.063-43.788-46.063z" fill="#1a1a1a" />
                        </g>
                        <g transform="translate(-564.924 20.904)">
                            <rect rx="7.087" ry="7.087" y="467.049" x="856.503" height="124.987" width="59.436" fill="#fff" stroke="#333" stroke-width=".8"
                            />
                            <path d="M889.816 476.152s-18.589 32.438-11.395 80.253l-8.676 2.7 29.356 23.828 1.798-34.845-10.342 3.574c-6.967-42.936 12.14-69.888 12.14-69.888l-12.881-5.622z"
                                fill="#1a1a1a" />
                        </g>
                        <g transform="matrix(1.07628 0 0 1.07628 223.677 323.667)">
                            <rect rx="6.584" ry="6.584" y="342.66" x="63.09" height="116.129" width="116.129" fill="#fff" stroke="#333" stroke-width=".743"
                            />
                            <path d="M169.854 430.823l-30.098-30.098 30.098-30.098a3.1 3.1 0 0 0 .71-1.107 3.095 3.095 0 0 0-.71-3.277l-14.218-14.218a3.102 3.102 0 0 0-3.277-.71 3.092 3.092 0 0 0-1.107.707l-30.098 30.098-30.097-30.098a3.092 3.092 0 0 0-1.107-.707 3.095 3.095 0 0 0-3.277.71l-14.218 14.218a3.102 3.102 0 0 0 0 4.384l30.098 30.098-30.098 30.098a3.143 3.143 0 0 0-.71 1.106 3.096 3.096 0 0 0 .71 3.277l14.218 14.219a3.102 3.102 0 0 0 4.384 0l30.098-30.098 30.097 30.098a3.1 3.1 0 0 0 1.107.71 3.095 3.095 0 0 0 3.277-.71l14.218-14.219a3.096 3.096 0 0 0 .71-3.277 3.1 3.1 0 0 0-.71-1.106z"
                                fill="red" />
                        </g>
                        <g transform="matrix(1.07628 0 0 1.07628 219.888 323.056)">
                            <rect width="116.129" height="116.129" x="193.359" y="342.66" ry="6.584" rx="6.584" fill="#fff" stroke="#333" stroke-width=".743"
                            />
                            <path d="M285.528 361.97l-46.506 46.506-21.703-21.703-15.502 15.502 37.205 37.205 62.008-62.008z" fill="#0f0" />
                        </g>
                        <rect rx="7.087" ry="7.087" y="622.835" x="291.579" height="59.436" width="59.436" fill="#646464" stroke="#333" stroke-width=".8"
                        />
                        <g transform="translate(-352.36 -254.981)">
                            <rect rx="7.087" ry="7.087" y="742.934" x="712.148" height="124.987" width="124.987" fill="#fff" stroke="#333" stroke-width=".8"
                            />
                            <path d="M740.98 771.766h67.323v67.323H740.98z" />
                        </g>
                        <rect rx="7.087" ry="7.087" y="418.412" x="291.579" height="59.436" width="59.436" fill="#646464" stroke="#333" stroke-width=".8"
                        />
                        <rect rx="7.087" ry="7.087" y="622.835" x="493.548" height="59.436" width="59.436" fill="#646464" stroke="#333" stroke-width=".8"
                        />
                        <rect rx="7.087" ry="7.087" y="418.412" x="493.548" height="59.436" width="59.436" fill="#646464" stroke="#333" stroke-width=".8"
                        />
                    </g>
                    <rect id="close" style="opacity:0.6" class="button" width="124.987" height="59.436" x="126.083" y="366.561" ry="7.087" rx="7.087"
                        stroke="#333" stroke-width=".8" />
                    <rect id="tiltup" style="opacity:0.6" class="button" width="59.436" height="124.987" x="259.843" y="231.678" opacity="1"
                        ry="7.087" rx="7.087" stroke="#333" stroke-width=".8" />
                    <rect id="cancel" style="opacity:0.6" class="button" width="124.987" height="124.987" x="57.874" y="436.191" ry="7.087" rx="7.087"
                        stroke="#333" stroke-width=".8" />
                    <rect id="open" style="opacity:0.6" class="button" width="124.987" height="59.436" x="126.083" y="162.138" ry="7.087" rx="7.087"
                        stroke="#333" stroke-width=".8" />
                    <rect id="tiltdown" style="opacity:0.6" class="button" width="59.436" height="124.987" x="57.874" y="231.678" ry="7.087"
                        rx="7.087" stroke="#333" stroke-width=".8" />
                    <rect id="okay" style="opacity:0.6" class="button" width="124.987" height="124.987" x="194.292" y="435.58" ry="7.087" rx="7.087"
                        stroke="#333" stroke-width=".8" />
                    <rect id="stop" style="opacity:0.6" class="button" width="124.987" height="124.987" x="126.083" y="231.678" ry="7.087" rx="7.087"
                        stroke="#333" stroke-width=".8" />
                </svg>

            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'pv-keypad',
            listeners: {
                'keypad.tap': 'tap_handler'
            },
            properties: {
                data: {
                    type: Object,
                    value: {}
                }
            },
            buttons_ids: [
                "close", "tiltup", "cancel", "open", "tiltdown", "okay", "stop"
            ],
            reset_buttons: function () {
                for (var i = 0; i < this.buttons_ids.length; i++) {
                    this.$[this.buttons_ids[i]].style.opacity = 0.6;
                }
                this.d_key_handler = function () {
                    console.log("pressed inactive tiltup key");
                }
                this.a_key_handler = function () {
                    console.log("pressed inactive tiltdown key");
                }
                this.w_key_handler = function () {
                    console.log("pressed inactive open key");
                }
                this.z_key_handler = function () {
                    console.log("pressed inactive close key");
                }
                this.s_key_handler = function () {
                    console.log("pressed inactive stop key");
                }
                this.okay_key_handler = function () {
                    console.log("pressed inactive okay key");
                }
                this.cancel_key_handler = function () {
                    console.log("pressed inactive cancel key");
                }
            },


            // ready: function () {
            //     this.$.keypad.addEventListener("tap", this.tap_handler.bind(this), false);
            // },
            tap_handler: function (event, e) {
                switch (event.target.id) {
                    case "cancel":
                        this.cancel_key_handler();
                        break;
                    case "okay":
                        this.okay_key_handler();
                        break;
                    case "tiltup":
                        this.d_key_handler();
                        break;
                    case "tiltdown":
                        this.a_key_handler();
                        break;
                    case "open":
                        this.w_key_handler();
                        break;
                    case "close":
                        this.z_key_handler();
                        break;
                    case "stop":
                        this.s_key_handler();
                        break;
                }
                console.log("test");
            },
            activate_key: function (key) {
                this.$[key].style.opacity = 0;
            },
            deactivate_key: function (key) {
                this.$[key].style.opacity = 0.6;
            },
            _dataChanged: function (_new, _old) {
                if (_new) {
                    if (this.data.type == "pv-keypad-alt") {
                        this.reset_buttons();
                        this.hide = false;



                        //for (var [key, value] of Object.entries(this.data)) {
                        for (var key in this.data){
                            var value = this.data[key];
                            switch (key) {
                                case "tiltup":
                                    if (value) {
                                        this.activate_key(key);
                                        document.handle_key_d = document.handle_command(value, key);
                                        this.d_key_handler = document.handle_key_d;
                                    }
                                    break;
                                case "tiltdown":
                                    if (value) {
                                        this.activate_key(key);
                                        document.handle_key_a = document.handle_command(value, key);
                                        this.a_key_handler = document.handle_key_a;
                                    }
                                    break;
                                case "open":
                                    if (value) {
                                        this.activate_key(key);
                                        document.handle_key_w = document.handle_command(value, key);
                                        this.w_key_handler = document.handle_key_w;
                                    }
                                    break;
                                case "close":
                                    if (value) {
                                        this.activate_key(key);
                                        document.handle_key_z = document.handle_command(value, key);
                                        this.z_key_handler = document.handle_key_z;
                                    }
                                    break;
                                case "stop":
                                    if (value) {
                                        this.activate_key(key);
                                        document.handle_key_s = document.handle_command(value, key);
                                        this.s_key_handler = document.handle_key_s;
                                    }
                                    break;
                                case "okay":
                                    if (value) {
                                        this.activate_key(key);
                                        document.handle_key_okay = document.handle_command(value, key);
                                        this.okay_key_handler = document.handle_key_okay;
                                    }
                                    break;
                                case "cancel":
                                    if (value) {
                                        this.activate_key(key);
                                        document.handle_key_x = document.handle_command(value, key);
                                        this.cancel_key_handler = document.handle_key_x;

                                    }
                                    break;
                            }
                        }
                    } else {
                        this.hide = true;
                    }
                } else {
                    this.hide = true;
                }
            },
            handleEmptyConfirm: function () {
                console.log("not a confirm button");
            },
            empty: function (key) {
                return function () {
                    console.log("disabled this button: ", key);
                };
            },

        });
    </script>
</dom-module>